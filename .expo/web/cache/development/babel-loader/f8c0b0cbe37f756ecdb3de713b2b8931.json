{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport { Box, NativeBaseProvider, Text, VStack, Button, Icon, Pressable, HStack, Image, FlatList, Divider, Fab, Modal, FormControl, Input } from 'native-base';\nimport { MaterialIcons } from '@expo/vector-icons';\nimport PropTypes from 'prop-types';\nimport Moment from 'react-moment';\nimport DisplayAlert from \"./DisplayAlert\";\nimport Storage from \"./Storage\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nvar asyncStorage = new Storage();\nvar displayAlert = new DisplayAlert();\n\nvar FeedScreen = function (_Component) {\n  _inherits(FeedScreen, _Component);\n\n  var _super = _createSuper(FeedScreen);\n\n  function FeedScreen(props) {\n    var _this;\n\n    _classCallCheck(this, FeedScreen);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      data: {},\n      posts: [],\n      ids: [],\n      uploadModalVisible: false,\n      viewPostModalVisible: false,\n      postText: '',\n      currentPost: [],\n      editText: '',\n      editVisible: false\n    };\n    return _this;\n  }\n\n  _createClass(FeedScreen, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var navigation = this.props.navigation;\n      asyncStorage.getData(function (data) {\n        _this2.setState({\n          data: data\n        });\n\n        _this2.getIds();\n\n        navigation.addListener('focus', function () {\n          _this2.getIds();\n        });\n      });\n    }\n  }, {\n    key: \"getIds\",\n    value: function getIds() {\n      var _this3 = this;\n\n      var data = this.state.data;\n      var idList = [data.id];\n      fetch(\"http://localhost:3333/api/1.0.0/user/\" + data.id + \"/friends\", {\n        method: 'GET',\n        headers: {\n          'X-Authorization': data.token\n        }\n      }).then(function (response) {\n        if (response.status === 401) {\n          return Promise.reject(new Error(\"Unauthorised. Status: \" + response.status));\n        }\n\n        if (response.status === 403) {\n          return Promise.reject(new Error(\"Can only view the friends of yourself or your friends. Status: \" + response.status));\n        }\n\n        if (response.status === 404) {\n          return Promise.reject(new Error(\"Not found. Status: \" + response.status));\n        }\n\n        if (response.status === 500) {\n          return Promise.reject(new Error(\"Server error. Status: \" + response.status));\n        }\n\n        return response.json();\n      }).then(function (responseJson) {\n        for (var i = 0; i < responseJson.length; i += 1) {\n          idList.push(responseJson[i].user_id);\n        }\n\n        _this3.setState({\n          ids: idList\n        });\n\n        _this3.getPosts();\n      }).catch(function (error) {\n        displayAlert.displayAlert(error);\n      });\n    }\n  }, {\n    key: \"getPosts\",\n    value: function getPosts() {\n      var _this4 = this;\n\n      var _this$state = this.state,\n          data = _this$state.data,\n          ids = _this$state.ids;\n      var postsList = [];\n      var idList = ids;\n\n      var _loop = function _loop(i) {\n        fetch(\"http://localhost:3333/api/1.0.0/user/\" + idList[i] + \"/post\", {\n          method: 'GET',\n          headers: {\n            'X-Authorization': data.token\n          }\n        }).then(function (response) {\n          if (response.status === 401) {\n            return Promise.reject(new Error(\"Unauthorised. Status: \" + response.status));\n          }\n\n          if (response.status === 403) {\n            return Promise.reject(new Error(\"Can only view the posts of yourself or your friends. Status: \" + response.status));\n          }\n\n          if (response.status === 404) {\n            return Promise.reject(new Error(\"Not found. Status: \" + response.status));\n          }\n\n          if (response.status === 500) {\n            return Promise.reject(new Error(\"Server error. Status: \" + response.status));\n          }\n\n          return response.json();\n        }).then(function (responseJson) {\n          if (responseJson.length > 0) {\n            var _loop2 = function _loop2(j) {\n              _this4.getProfileImage(idList[i]).then(function (responseBlob) {\n                var responseUrl = URL.createObjectURL(responseBlob);\n                postsList.push([responseJson[j], responseUrl]);\n\n                _this4.setState({\n                  posts: postsList\n                });\n              });\n            };\n\n            for (var j = 0; j < responseJson.length; j += 1) {\n              _loop2(j);\n            }\n          }\n        }).catch(function (error) {\n          displayAlert.displayAlert(error);\n        });\n      };\n\n      for (var i = 0; i < idList.length; i += 1) {\n        _loop(i);\n      }\n    }\n  }, {\n    key: \"getProfileImage\",\n    value: function getProfileImage(userId) {\n      var data = this.state.data;\n      return fetch(\"http://localhost:3333/api/1.0.0/user/\" + userId + \"/photo\", {\n        method: 'GET',\n        headers: {\n          'X-Authorization': data.token\n        }\n      }).then(function (response) {\n        if (response.status === 401) {\n          return Promise.reject(new Error(\"Unauthorised. Status: \" + response.status));\n        }\n\n        if (response.status === 404) {\n          return Promise.reject(new Error(\"Not found. Status: \" + response.status));\n        }\n\n        if (response.status === 500) {\n          return Promise.reject(new Error(\"Server error. Status: \" + response.status));\n        }\n\n        return response.blob();\n      });\n    }\n  }, {\n    key: \"uploadPost\",\n    value: function uploadPost() {\n      var _this5 = this;\n\n      var _this$state2 = this.state,\n          data = _this$state2.data,\n          postText = _this$state2.postText;\n      fetch(\"http://localhost:3333/api/1.0.0/user/\" + data.id + \"/post\", {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-Authorization': data.token\n        },\n        body: JSON.stringify({\n          text: postText\n        })\n      }).then(function (response) {\n        if (response.status === 401) {\n          return Promise.reject(new Error(\"Unauthorised. Status: \" + response.status));\n        }\n\n        if (response.status === 403) {\n          return Promise.reject(new Error(\"Can only view the friends of yourself or your friends. Status: \" + response.status));\n        }\n\n        if (response.status === 404) {\n          return Promise.reject(new Error(\"Not found. Status: \" + response.status));\n        }\n\n        if (response.status === 500) {\n          return Promise.reject(new Error(\"Server error. Status: \" + response.status));\n        }\n\n        _this5.getPosts();\n\n        return displayAlert.displayAlert('Post uploaded.');\n      }).catch(function (error) {\n        displayAlert.displayAlert(error);\n      });\n    }\n  }, {\n    key: \"deletePost\",\n    value: function deletePost(postId) {\n      var _this6 = this;\n\n      var data = this.state.data;\n      fetch(\"http://localhost:3333/api/1.0.0/user/\" + data.id + \"/post/ \" + postId, {\n        method: 'DELETE',\n        headers: {\n          'X-Authorization': data.token\n        }\n      }).then(function (response) {\n        if (response.status === 401) {\n          return Promise.reject(new Error(\"Unauthorised. Status: \" + response.status));\n        }\n\n        if (response.status === 403) {\n          return Promise.reject(new Error(\"Can only delete your own posts. Status: \" + response.status));\n        }\n\n        if (response.status === 404) {\n          return Promise.reject(new Error(\"Not found. Status: \" + response.status));\n        }\n\n        if (response.status === 500) {\n          return Promise.reject(new Error(\"Server error. Status: \" + response.status));\n        }\n\n        _this6.getPosts();\n\n        _this6.setState({\n          viewPostModalVisible: false\n        });\n\n        return displayAlert.displayAlert('Post deleted.');\n      }).catch(function (error) {\n        displayAlert.displayAlert(error);\n      });\n    }\n  }, {\n    key: \"updatePost\",\n    value: function updatePost(postId) {\n      var _this7 = this;\n\n      var _this$state3 = this.state,\n          data = _this$state3.data,\n          editText = _this$state3.editText;\n      fetch(\"http://localhost:3333/api/1.0.0/user/\" + data.id + \"/post/\" + postId, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-Authorization': data.token\n        },\n        body: JSON.stringify({\n          text: editText\n        })\n      }).then(function (response) {\n        if (response.status === 400) {\n          return Promise.reject(new Error(\"Bad request. Status: \" + response.status));\n        }\n\n        if (response.status === 401) {\n          return Promise.reject(new Error(\"Unauthorised. Status: \" + response.status));\n        }\n\n        if (response.status === 403) {\n          return Promise.reject(new Error(\"Can only update your own posts. Status: \" + response.status));\n        }\n\n        if (response.status === 404) {\n          return Promise.reject(new Error(\"Not found. Status: \" + response.status));\n        }\n\n        if (response.status === 500) {\n          return Promise.reject(new Error(\"Server error. Status: \" + response.status));\n        }\n\n        _this7.getPosts();\n\n        _this7.setState({\n          viewPostModalVisible: false\n        });\n\n        return displayAlert.displayAlert('Post updated.');\n      }).catch(function (error) {\n        displayAlert.displayAlert(error);\n      });\n    }\n  }, {\n    key: \"likePost\",\n    value: function likePost(userPostId, postId) {\n      var _this8 = this;\n\n      var data = this.state.data;\n      fetch(\"http://localhost:3333/api/1.0.0/user/\" + userPostId + \"/post/\" + postId + \"/like\", {\n        method: 'POST',\n        headers: {\n          'X-Authorization': data.token\n        }\n      }).then(function (response) {\n        if (response.status === 400) {\n          return Promise.reject(new Error(\"Post already liked. Status: \" + response.status));\n        }\n\n        if (response.status === 401) {\n          return Promise.reject(new Error(\"Unauthorised. Status: \" + response.status));\n        }\n\n        if (response.status === 403) {\n          return Promise.reject(new Error(\"Can only like your friends posts. Status: \" + response.status));\n        }\n\n        if (response.status === 404) {\n          return Promise.reject(new Error(\"Not found. Status: \" + response.status));\n        }\n\n        if (response.status === 500) {\n          return Promise.reject(new Error(\"Server error. Status: \" + response.status));\n        }\n\n        _this8.getPosts();\n\n        _this8.setState({\n          viewPostModalVisible: false\n        });\n\n        return displayAlert.displayAlert('Post liked');\n      }).catch(function (error) {\n        displayAlert.displayAlert(error);\n      });\n    }\n  }, {\n    key: \"deleteLike\",\n    value: function deleteLike(userPostId, postId) {\n      var _this9 = this;\n\n      var data = this.state.data;\n      fetch(\"http://localhost:3333/api/1.0.0/user/\" + userPostId + \"/post/\" + postId + \"/like\", {\n        method: 'DELETE',\n        headers: {\n          'X-Authorization': data.token\n        }\n      }).then(function (response) {\n        if (response.status === 401) {\n          return Promise.reject(new Error(\"Unauthorised. Status: \" + response.status));\n        }\n\n        if (response.status === 403) {\n          return Promise.reject(new Error(\"You have not liked this post. Status: \" + response.status));\n        }\n\n        if (response.status === 404) {\n          return Promise.reject(new Error(\"Not found. Status: \" + response.status));\n        }\n\n        if (response.status === 500) {\n          return Promise.reject(new Error(\"Server error. Status: \" + response.status));\n        }\n\n        _this9.getPosts();\n\n        _this9.setState({\n          viewPostModalVisible: false\n        });\n\n        return displayAlert.displayAlert(\"Post unliked, \" + postId);\n      }).catch(function (error) {\n        displayAlert.displayAlert(error);\n      });\n    }\n  }, {\n    key: \"viewPost\",\n    value: function viewPost(item) {\n      return _jsxs(HStack, {\n        justifyContent: \"space-between\",\n        children: [_jsx(Box, {\n          children: _jsxs(HStack, {\n            space: 5,\n            children: [_jsx(Image, {\n              source: {\n                uri: item[1]\n              },\n              size: 50,\n              borderRadius: \"100\",\n              alt: \"Profile Picture\"\n            }), _jsxs(VStack, {\n              children: [_jsxs(Text, {\n                bold: true,\n                children: [item[0].author.first_name, \" \", item[0].author.last_name]\n              }), _jsx(Text, {\n                children: item[0].text\n              })]\n            })]\n          })\n        }), _jsxs(VStack, {\n          children: [_jsx(Text, {\n            children: _jsx(Moment, {\n              date: item[0].timestamp,\n              format: \"D MMM\"\n            })\n          }), _jsx(Box, {\n            alignSelf: \"flex-start\",\n            children: _jsxs(Text, {\n              children: [\"Likes: \", item[0].numLikes]\n            })\n          })]\n        })]\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this10 = this;\n\n      var navigation = this.props.navigation;\n      var _this$state4 = this.state,\n          uploadModalVisible = _this$state4.uploadModalVisible,\n          viewPostModalVisible = _this$state4.viewPostModalVisible,\n          posts = _this$state4.posts,\n          currentPost = _this$state4.currentPost,\n          editVisible = _this$state4.editVisible,\n          data = _this$state4.data,\n          editText = _this$state4.editText,\n          postText = _this$state4.postText;\n      return _jsx(NativeBaseProvider, {\n        children: _jsxs(Box, {\n          flex: 1,\n          boxSize: \"100%\",\n          children: [_jsx(FlatList, {\n            extraData: this.state,\n            data: posts,\n            renderItem: function renderItem(_ref) {\n              var item = _ref.item;\n              return _jsxs(Pressable, {\n                onPress: function onPress() {\n                  _this10.setState({\n                    viewPostModalVisible: true,\n                    currentPost: item\n                  });\n                },\n                pl: \"5\",\n                pr: \"5\",\n                pb: \"5\",\n                pt: \"5\",\n                children: [_this10.viewPost(item), _jsx(Divider, {\n                  mt: 10,\n                  bg: \"muted.400\"\n                })]\n              });\n            },\n            keyExtractor: function keyExtractor(item, index) {\n              return index.toString();\n            }\n          }), _jsx(Fab, {\n            onPress: function onPress() {\n              return _this10.setState({\n                uploadModalVisible: true\n              });\n            },\n            bg: \"darkBlue.700\",\n            icon: _jsx(Icon, {\n              as: _jsx(MaterialIcons, {\n                style: {\n                  color: \"white\",\n                  fontSize: 30\n                },\n                name: \"post-add\"\n              })\n            }),\n            size: 50,\n            placement: \"bottom-right\"\n          }), _jsx(Fab, {\n            onPress: function onPress() {\n              return navigation.navigate('Drafts');\n            },\n            bg: \"darkBlue.700\",\n            label: _jsx(Text, {\n              color: \"white\",\n              fontSize: \"sm\",\n              children: \"Drafts\"\n            }),\n            size: 50,\n            placement: \"bottom-left\"\n          }), _jsx(Modal, {\n            isOpen: uploadModalVisible,\n            onClose: function onClose() {\n              return _this10.setState({\n                uploadModalVisible: false\n              });\n            },\n            children: _jsxs(Modal.Content, {\n              maxWidth: \"400px\",\n              children: [_jsx(Modal.CloseButton, {}), _jsx(Modal.Header, {\n                children: \"Add Post\"\n              }), _jsx(Modal.Body, {\n                children: _jsx(FormControl, {\n                  children: _jsx(Input, {\n                    borderColor: \"coolGray.800\",\n                    placeholder: \"Enter text\",\n                    onChangeText: function onChangeText(value) {\n                      return _this10.setState({\n                        postText: value\n                      });\n                    },\n                    value: postText\n                  })\n                })\n              }), _jsx(Modal.Footer, {\n                justifyContent: \"space-evenly\",\n                children: _jsxs(Button.Group, {\n                  space: 2,\n                  children: [_jsx(Button, {\n                    bg: \"darkBlue.700\",\n                    onPress: function onPress() {\n                      return _this10.setState({\n                        uploadModalVisible: false,\n                        postText: ''\n                      });\n                    },\n                    children: \"Cancel\"\n                  }), _jsx(Button, {\n                    bg: \"darkBlue.700\",\n                    onPress: function onPress() {\n                      asyncStorage.saveDraft(postText);\n\n                      _this10.setState({\n                        uploadModalVisible: false,\n                        postText: ''\n                      });\n\n                      displayAlert.displayAlert('Post saved as draft.');\n                    },\n                    children: \"Save as draft\"\n                  }), _jsx(Button, {\n                    bg: \"darkBlue.700\",\n                    onPress: function onPress() {\n                      _this10.uploadPost();\n\n                      _this10.setState({\n                        uploadModalVisible: false,\n                        postText: ''\n                      });\n                    },\n                    children: \"Post\"\n                  })]\n                })\n              })]\n            })\n          }), currentPost.length > 0 && _jsx(Modal, {\n            isOpen: viewPostModalVisible,\n            onClose: function onClose() {\n              return _this10.setState({\n                viewPostModalVisible: false\n              });\n            },\n            children: _jsxs(Modal.Content, {\n              maxWidth: \"400px\",\n              children: [_jsx(Modal.CloseButton, {}), _jsx(Modal.Header, {\n                children: _jsx(Text, {\n                  children: \"Post\"\n                })\n              }), _jsx(Modal.Body, {\n                children: _jsx(FormControl, {\n                  children: this.viewPost(currentPost)\n                })\n              }), _jsx(Modal.Footer, {\n                justifyContent: \"space-evenly\",\n                children: Object.keys(currentPost[0]).length > 0 && _jsxs(HStack, {\n                  space: 2,\n                  children: [_jsx(Button, {\n                    bg: \"darkBlue.700\",\n                    onPress: function onPress() {\n                      return _this10.setState({\n                        viewPostModalVisible: false\n                      });\n                    },\n                    children: \"Cancel\"\n                  }), !editVisible && currentPost[0].author.user_id === data.id && _jsx(Button, {\n                    onPress: function onPress() {\n                      return _this10.setState({\n                        editVisible: true,\n                        viewPostModalVisible: false\n                      });\n                    },\n                    children: \"Edit\"\n                  }), !editVisible && currentPost[0].author.user_id === data.id && _jsx(Button, {\n                    onPress: function onPress() {\n                      return _this10.deletePost(currentPost[0].post_id);\n                    },\n                    children: \"Delete\"\n                  }), !editVisible && currentPost[0].author.user_id !== data.id && _jsx(Button, {\n                    onPress: function onPress() {\n                      return _this10.likePost(currentPost[0].author.user_id, currentPost[0].post_id);\n                    },\n                    children: \"Like\"\n                  }), !editVisible && currentPost[0].author.user_id !== data.id && _jsx(Button, {\n                    onPress: function onPress() {\n                      return _this10.deleteLike(currentPost[0].author.user_id, currentPost[0].post_id);\n                    },\n                    children: \"Unlike\"\n                  })]\n                })\n              })]\n            })\n          }), currentPost.length > 0 && _jsx(Modal, {\n            isOpen: editVisible,\n            onClose: function onClose() {\n              return _this10.setState({\n                editVisible: false\n              });\n            },\n            children: _jsxs(Modal.Content, {\n              maxWidth: \"400px\",\n              children: [_jsx(Modal.CloseButton, {}), _jsx(Modal.Header, {\n                children: \"Edit Post\"\n              }), _jsx(Modal.Body, {\n                children: _jsx(FormControl, {\n                  children: _jsx(Input, {\n                    borderColor: \"coolGray.800\",\n                    placeholder: currentPost[0].text,\n                    onChangeText: function onChangeText(value) {\n                      return _this10.setState({\n                        editText: value\n                      });\n                    },\n                    value: editText\n                  })\n                })\n              }), _jsx(Modal.Footer, {\n                justifyContent: \"space-evenly\",\n                children: _jsxs(Button.Group, {\n                  space: 2,\n                  children: [_jsx(Button, {\n                    bg: \"darkBlue.700\",\n                    onPress: function onPress() {\n                      return _this10.setState({\n                        editVisible: false\n                      });\n                    },\n                    children: \"Cancel\"\n                  }), _jsx(Button, {\n                    bg: \"darkBlue.700\",\n                    onPress: function onPress() {\n                      _this10.updatePost(currentPost[0].post_id);\n\n                      _this10.setState({\n                        editVisible: false,\n                        postText: ''\n                      });\n                    },\n                    children: \"Update\"\n                  })]\n                })\n              })]\n            })\n          })]\n        })\n      });\n    }\n  }]);\n\n  return FeedScreen;\n}(Component);\n\nFeedScreen.propTypes = {\n  navigation: PropTypes.shape({\n    navigate: PropTypes.func.isRequired,\n    addListener: PropTypes.func.isRequired\n  }).isRequired\n};\nexport default FeedScreen;","map":{"version":3,"sources":["D:/Users/georg/Desktop/MAD/SpaceBook/components/FeedScreen.js"],"names":["React","Component","Box","NativeBaseProvider","Text","VStack","Button","Icon","Pressable","HStack","Image","FlatList","Divider","Fab","Modal","FormControl","Input","MaterialIcons","PropTypes","Moment","DisplayAlert","Storage","asyncStorage","displayAlert","FeedScreen","props","state","data","posts","ids","uploadModalVisible","viewPostModalVisible","postText","currentPost","editText","editVisible","navigation","getData","setState","getIds","addListener","idList","id","fetch","method","headers","token","then","response","status","Promise","reject","Error","json","responseJson","i","length","push","user_id","getPosts","catch","error","postsList","j","getProfileImage","responseBlob","responseUrl","URL","createObjectURL","userId","blob","body","JSON","stringify","text","postId","userPostId","item","uri","author","first_name","last_name","timestamp","numLikes","viewPost","index","toString","color","fontSize","navigate","value","saveDraft","uploadPost","Object","keys","deletePost","post_id","likePost","deleteLike","updatePost","propTypes","shape","func","isRequired"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Box, NativeBaseProvider, Text, VStack, Button, Icon, Pressable, HStack, Image, FlatList, Divider, Fab, Modal, FormControl, Input } from 'native-base';\r\nimport { MaterialIcons } from '@expo/vector-icons';\r\n// import { Button, FlatList, Text, View, Modal, TextInput, Pressable, StyleSheet } from 'react-native';\r\nimport PropTypes from 'prop-types';\r\nimport Moment from 'react-moment';\r\n\r\nimport DisplayAlert from './DisplayAlert';\r\nimport Storage from './Storage'\r\n\r\nconst asyncStorage = new Storage();\r\n\r\nconst displayAlert = new DisplayAlert();\r\n\r\nclass FeedScreen extends Component {\r\n    constructor(props){\r\n        super(props);\r\n\r\n        this.state = {\r\n            data: {},\r\n            posts: [],\r\n            ids: [],\r\n            uploadModalVisible: false,\r\n            viewPostModalVisible: false,\r\n            postText: '',\r\n            currentPost: [],\r\n            editText: '',\r\n            editVisible: false,\r\n        }\r\n    }\r\n\r\n    componentDidMount(){\r\n        const { navigation } = this.props;\r\n        asyncStorage.getData((data) => {\r\n            this.setState({\r\n                data\r\n            });\r\n            this.getIds();\r\n            navigation.addListener('focus', () => {\r\n                this.getIds();\r\n            });\r\n        });\r\n    }\r\n\r\n    getIds(){\r\n        const { data } = this.state;\r\n        const idList = [data.id];\r\n        fetch(`http://localhost:3333/api/1.0.0/user/${ data.id }/friends`, {\r\n            method: 'GET',\r\n            headers: {\r\n                'X-Authorization': data.token\r\n            }\r\n        })\r\n        .then((response) => {\r\n            if (response.status === 401){\r\n                return Promise.reject(new Error(`Unauthorised. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 403){\r\n                return Promise.reject(new Error(`Can only view the friends of yourself or your friends. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 404){\r\n                return Promise.reject(new Error(`Not found. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 500){\r\n                return Promise.reject(new Error(`Server error. Status: ${ response.status }`));\r\n            }\r\n            return response.json()\r\n        })\r\n        .then((responseJson) => {\r\n            for (let i = 0; i < responseJson.length; i+=1){\r\n                idList.push(responseJson[i].user_id);\r\n            }\r\n            this.setState({ids: idList});\r\n            this.getPosts();\r\n        })\r\n        .catch((error) => {\r\n            displayAlert.displayAlert(error);\r\n        });\r\n    }\r\n\r\n    getPosts(){\r\n        const { data, ids } = this.state;\r\n        const postsList = [];\r\n        const idList = ids;\r\n        for (let i = 0; i < idList.length; i+=1){\r\n            fetch(`http://localhost:3333/api/1.0.0/user/${ idList[i] }/post`, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'X-Authorization': data.token\r\n                }\r\n            })\r\n            .then((response) => {\r\n                if (response.status === 401){\r\n                    return Promise.reject(new Error(`Unauthorised. Status: ${  response.status}`));\r\n                }\r\n                if (response.status === 403){\r\n                    return Promise.reject(new Error(`Can only view the posts of yourself or your friends. Status: ${  response.status}`));\r\n                }\r\n                if (response.status === 404){\r\n                    return Promise.reject(new Error(`Not found. Status: ${  response.status}`));\r\n                }\r\n                if (response.status === 500){\r\n                    return Promise.reject(new Error(`Server error. Status: ${ response.status }`));\r\n                }\r\n                return response.json()\r\n            })\r\n            .then((responseJson) => {\r\n                if (responseJson.length > 0){\r\n                    for (let j=0;j<responseJson.length;j+=1){\r\n                        this.getProfileImage(idList[i])\r\n                        .then((responseBlob) => {\r\n                            const responseUrl = URL.createObjectURL(responseBlob);\r\n                            postsList.push([responseJson[j], responseUrl])\r\n                            this.setState({\r\n                                posts: postsList\r\n                            });\r\n                        });\r\n                    }\r\n                }\r\n            })\r\n            .catch((error) => {\r\n                displayAlert.displayAlert(error);\r\n            });\r\n        }\r\n    }\r\n\r\n    getProfileImage(userId) {\r\n        const { data } = this.state;\r\n        return fetch(`http://localhost:3333/api/1.0.0/user/${  userId  }/photo`, {\r\n            method: 'GET',\r\n            headers: {\r\n                'X-Authorization': data.token\r\n            }\r\n        })\r\n        .then((response) => {\r\n            if (response.status === 401){\r\n                return Promise.reject(new Error(`Unauthorised. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 404){\r\n                return Promise.reject(new Error(`Not found. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 500){\r\n                return Promise.reject(new Error(`Server error. Status: ${ response.status }`));\r\n            }\r\n            return response.blob();\r\n        })\r\n    }\r\n\r\n    uploadPost(){\r\n        const { data, postText } = this.state;\r\n        fetch(`http://localhost:3333/api/1.0.0/user/${ data.id }/post`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'X-Authorization': data.token\r\n            },\r\n            body: JSON.stringify({\r\n                text: postText\r\n            })\r\n        })\r\n        .then((response) => {\r\n            if (response.status === 401){\r\n                return Promise.reject(new Error(`Unauthorised. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 403){\r\n                return Promise.reject(new Error(`Can only view the friends of yourself or your friends. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 404){\r\n                return Promise.reject(new Error(`Not found. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 500){\r\n                return Promise.reject(new Error(`Server error. Status: ${ response.status }`));\r\n            }            \r\n            this.getPosts(); \r\n            return displayAlert.displayAlert('Post uploaded.');\r\n        })\r\n        .catch((error) => {\r\n            displayAlert.displayAlert(error);\r\n        })\r\n    }\r\n\r\n    deletePost(postId) {\r\n        const { data } = this.state;\r\n        fetch(`http://localhost:3333/api/1.0.0/user/${ data.id }/post/ ${ postId }`, {\r\n            method: 'DELETE',\r\n            headers: {\r\n                'X-Authorization': data.token\r\n            }\r\n        })\r\n        .then((response) => {\r\n            if (response.status === 401){\r\n                return Promise.reject(new Error(`Unauthorised. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 403){\r\n                return Promise.reject(new Error(`Can only delete your own posts. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 404){\r\n                return Promise.reject(new Error(`Not found. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 500){\r\n                return Promise.reject(new Error(`Server error. Status: ${ response.status }`));\r\n            } \r\n            this.getPosts();\r\n            this.setState({viewPostModalVisible: false});\r\n            return displayAlert.displayAlert('Post deleted.');\r\n        })\r\n        .catch((error) => {\r\n            displayAlert.displayAlert(error);\r\n        })\r\n    }\r\n\r\n    updatePost(postId) {\r\n        const { data, editText } = this.state;\r\n        fetch(`http://localhost:3333/api/1.0.0/user/${ data.id }/post/${ postId }`, {\r\n            method: 'PATCH',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'X-Authorization': data.token\r\n            },\r\n            body: JSON.stringify({text: editText})\r\n        })\r\n        .then((response) => {\r\n            if (response.status === 400){\r\n                return Promise.reject(new Error(`Bad request. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 401){\r\n                return Promise.reject(new Error(`Unauthorised. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 403){\r\n                return Promise.reject(new Error(`Can only update your own posts. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 404){\r\n                return Promise.reject(new Error(`Not found. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 500){\r\n                return Promise.reject(new Error(`Server error. Status: ${ response.status }`));\r\n            } \r\n            this.getPosts();\r\n            this.setState({viewPostModalVisible: false})\r\n            return displayAlert.displayAlert('Post updated.');\r\n        })\r\n        .catch((error) => {\r\n            displayAlert.displayAlert(error);\r\n        });\r\n    }\r\n\r\n    likePost(userPostId, postId){\r\n        const { data } = this.state;\r\n        fetch(`http://localhost:3333/api/1.0.0/user/${ userPostId }/post/${ postId }/like`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'X-Authorization': data.token\r\n            }\r\n        })\r\n        .then((response) => {\r\n            if (response.status === 400){\r\n                return Promise.reject(new Error(`Post already liked. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 401){\r\n                return Promise.reject(new Error(`Unauthorised. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 403){\r\n                return Promise.reject(new Error(`Can only like your friends posts. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 404){\r\n                return Promise.reject(new Error(`Not found. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 500){\r\n                return Promise.reject(new Error(`Server error. Status: ${ response.status }`));\r\n            } \r\n            this.getPosts();\r\n            this.setState({viewPostModalVisible: false});\r\n            return displayAlert.displayAlert('Post liked');\r\n        })\r\n        .catch((error) => {\r\n            displayAlert.displayAlert(error);\r\n        })\r\n    }\r\n\r\n    deleteLike(userPostId, postId) {\r\n        const { data } = this.state;\r\n        fetch(`http://localhost:3333/api/1.0.0/user/${ userPostId }/post/${ postId }/like`, {\r\n            method: 'DELETE',\r\n            headers: {\r\n                'X-Authorization': data.token\r\n            }\r\n        })\r\n        .then((response) => {\r\n            if (response.status === 401){\r\n                return Promise.reject(new Error(`Unauthorised. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 403){\r\n                return Promise.reject(new Error(`You have not liked this post. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 404){\r\n                return Promise.reject(new Error(`Not found. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 500){\r\n                return Promise.reject(new Error(`Server error. Status: ${ response.status }`));\r\n            } \r\n            this.getPosts();\r\n            this.setState({viewPostModalVisible: false});\r\n            return displayAlert.displayAlert(`Post unliked, ${postId}`);\r\n        })\r\n        .catch((error) => {\r\n            displayAlert.displayAlert(error);\r\n        })\r\n    }\r\n\r\n    viewPost(item){\r\n        return (\r\n        <HStack justifyContent=\"space-between\">\r\n            <Box>\r\n                <HStack space={5}>\r\n                    <Image source={{uri: item[1]}} size={50} borderRadius=\"100\" alt=\"Profile Picture\"/>\r\n                    <VStack>\r\n                        <Text  bold>{item[0].author.first_name} {item[0].author.last_name}</Text>\r\n                        <Text>{item[0].text}</Text>\r\n                    </VStack>\r\n                </HStack>\r\n            </Box>\r\n            <VStack>\r\n                <Text><Moment date={item[0].timestamp} format=\"D MMM\"/></Text>\r\n                <Box alignSelf=\"flex-start\">\r\n                    <Text>Likes: {item[0].numLikes}</Text>\r\n                </Box>\r\n            </VStack>\r\n        </HStack>\r\n        );\r\n    }\r\n\r\n    render(){\r\n        const { navigation } = this.props;\r\n        const { uploadModalVisible, viewPostModalVisible, posts, currentPost, editVisible, data, editText, postText } = this.state;\r\n        return (\r\n            <NativeBaseProvider>\r\n                <Box flex={1} boxSize=\"100%\">\r\n                    <FlatList extraData={this.state} data={posts}\r\n                        renderItem={({item}) => (\r\n                            <Pressable onPress={() => {this.setState({viewPostModalVisible: true, currentPost: item})}} pl=\"5\" pr=\"5\" pb=\"5\" pt=\"5\">\r\n                                {this.viewPost(item)}\r\n                                <Divider mt={10} bg=\"muted.400\"/>\r\n                            </Pressable>\r\n                        )}\r\n                        keyExtractor={(item, index) => index.toString()}\r\n                    />\r\n                    <Fab onPress={() => this.setState({uploadModalVisible: true})} bg=\"darkBlue.700\" icon={<Icon as={<MaterialIcons style={{color: \"white\", fontSize: 30}} name=\"post-add\"/>}/>} size={50} placement=\"bottom-right\"/>\r\n                    <Fab onPress={() => navigation.navigate('Drafts')} bg=\"darkBlue.700\" label={<Text color=\"white\" fontSize=\"sm\">Drafts</Text>} size={50} placement='bottom-left'/>\r\n                    <Modal isOpen={uploadModalVisible} onClose={() => this.setState({uploadModalVisible: false})}>\r\n                        <Modal.Content maxWidth=\"400px\">\r\n                            <Modal.CloseButton/>\r\n                            <Modal.Header>Add Post</Modal.Header>\r\n                            <Modal.Body>\r\n                                <FormControl>\r\n                                    <Input borderColor=\"coolGray.800\" placeholder=\"Enter text\" onChangeText={value => this.setState({postText: value})} value={postText}/>\r\n                                </FormControl>\r\n                            </Modal.Body>\r\n                            <Modal.Footer justifyContent=\"space-evenly\" >\r\n                                <Button.Group space={2}>\r\n                                    <Button bg=\"darkBlue.700\" onPress={() => this.setState({uploadModalVisible: false, postText: ''})}>Cancel</Button>\r\n                                    <Button bg=\"darkBlue.700\" onPress={() => {\r\n                                        asyncStorage.saveDraft(postText);\r\n                                        this.setState({uploadModalVisible: false, postText: ''})\r\n                                        displayAlert.displayAlert('Post saved as draft.');\r\n                                    }}>Save as draft</Button>\r\n                                    <Button bg=\"darkBlue.700\" onPress={() => {\r\n                                        this.uploadPost();\r\n                                        this.setState({uploadModalVisible: false, postText: ''});\r\n                                        }}>Post</Button>\r\n                                </Button.Group>\r\n                            </Modal.Footer>\r\n                        </Modal.Content>\r\n                    </Modal>\r\n                    {currentPost.length > 0 && <Modal isOpen={viewPostModalVisible} onClose={() => this.setState({viewPostModalVisible: false})}>\r\n                        <Modal.Content maxWidth=\"400px\">\r\n                            <Modal.CloseButton/>\r\n                            <Modal.Header>\r\n                                <Text>Post</Text>\r\n                            </Modal.Header>\r\n                            <Modal.Body>\r\n                                <FormControl>\r\n                                    {this.viewPost(currentPost)}\r\n                                </FormControl>\r\n                            </Modal.Body>\r\n                            <Modal.Footer justifyContent=\"space-evenly\" >\r\n                                { Object.keys(currentPost[0]).length > 0 && <HStack space={2}>\r\n                                    <Button bg=\"darkBlue.700\" onPress={() => this.setState({viewPostModalVisible: false})}>Cancel</Button>\r\n                                    {!editVisible && (currentPost[0].author.user_id === data.id) && <Button onPress={() => this.setState({editVisible: true, viewPostModalVisible: false})}>Edit</Button>}\r\n                                    {!editVisible && (currentPost[0].author.user_id === data.id) && <Button onPress={() => this.deletePost(currentPost[0].post_id)}>Delete</Button>}\r\n                                    {!editVisible && (currentPost[0].author.user_id !== data.id) && <Button onPress={() => this.likePost(currentPost[0].author.user_id,currentPost[0].post_id)}>Like</Button>}\r\n                                    {!editVisible && (currentPost[0].author.user_id !== data.id) && <Button onPress={() => this.deleteLike(currentPost[0].author.user_id,currentPost[0].post_id)}>Unlike</Button>}\r\n                                </HStack>}\r\n                            </Modal.Footer>\r\n                        </Modal.Content>\r\n                    </Modal>}\r\n                    {currentPost.length > 0 && <Modal isOpen={editVisible} onClose={() => this.setState({editVisible: false})}>\r\n                        <Modal.Content maxWidth=\"400px\">\r\n                            <Modal.CloseButton/>\r\n                            <Modal.Header>Edit Post</Modal.Header>\r\n                            <Modal.Body>\r\n                                <FormControl>\r\n                                    <Input borderColor=\"coolGray.800\" placeholder={currentPost[0].text} onChangeText={value => this.setState({editText: value})} value={editText}/>\r\n                                </FormControl>\r\n                            </Modal.Body>\r\n                            <Modal.Footer justifyContent=\"space-evenly\" >\r\n                                <Button.Group space={2}>\r\n                                    <Button bg=\"darkBlue.700\" onPress={() => this.setState({editVisible: false})}>Cancel</Button>\r\n                                    <Button bg=\"darkBlue.700\" onPress={() => {\r\n                                        this.updatePost(currentPost[0].post_id);\r\n                                        this.setState({editVisible: false, postText: ''});\r\n                                        }}>Update</Button>\r\n                                </Button.Group>\r\n                            </Modal.Footer>\r\n                        </Modal.Content>\r\n                    </Modal>}\r\n                </Box>\r\n            </NativeBaseProvider>\r\n        );\r\n    }\r\n}\r\n\r\nFeedScreen.propTypes = {\r\n    navigation: PropTypes.shape({\r\n        navigate: PropTypes.func.isRequired,\r\n        addListener: PropTypes.func.isRequired\r\n    }).isRequired\r\n}\r\n\r\nexport default FeedScreen;"]},"metadata":{},"sourceType":"module"}