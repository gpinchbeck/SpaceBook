{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport { Camera } from 'expo-camera';\nimport PropTypes from 'prop-types';\nimport DisplayAlert from \"./DisplayAlert\";\nimport Storage from \"./Storage\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar asyncStorage = new Storage();\nvar displayAlert = new DisplayAlert();\n\nvar UploadPicture = function (_Component) {\n  _inherits(UploadPicture, _Component);\n\n  var _super = _createSuper(UploadPicture);\n\n  function UploadPicture(props) {\n    var _this;\n\n    _classCallCheck(this, UploadPicture);\n\n    _this = _super.call(this, props);\n\n    _this.sendToServer = function _callee(data) {\n      var navigation, loginInfo, res, blob;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              navigation = _this.props.navigation;\n              loginInfo = _this.state.loginInfo;\n              _context.next = 4;\n              return _regeneratorRuntime.awrap(fetch(data.base64));\n\n            case 4:\n              res = _context.sent;\n              _context.next = 7;\n              return _regeneratorRuntime.awrap(res.blob());\n\n            case 7:\n              blob = _context.sent;\n              return _context.abrupt(\"return\", fetch(\"http://localhost:3333/api/1.0.0/user/\" + loginInfo.id + \"/photo\", {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'image/png',\n                  'X-Authorization': loginInfo.token\n                },\n                body: blob\n              }).then(function (response) {\n                if (response.status === 400) {\n                  return Promise.reject(new Error(\"Bad request. Status: \" + response.status));\n                }\n\n                if (response.status === 401) {\n                  return Promise.reject(new Error(\"Unauthorised. Status: \" + response.status));\n                }\n\n                if (response.status === 404) {\n                  return Promise.reject(new Error(\"Not found. Status: \" + response.status));\n                }\n\n                if (response.status === 500) {\n                  return Promise.reject(new Error(\"Server error. Status: \" + response.status));\n                }\n\n                displayAlert.displayAlert(\"Picture uploaded\");\n                return navigation.navigate('Settings');\n              }).catch(function (error) {\n                displayAlert.displayAlert(error);\n              }));\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.takePicture = function _callee2() {\n      var options;\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!_this.camera) {\n                _context2.next = 4;\n                break;\n              }\n\n              options = {\n                quality: 0.5,\n                base64: true,\n                onPictureSaved: function onPictureSaved(data) {\n                  return _this.sendToServer(data);\n                }\n              };\n              _context2.next = 4;\n              return _regeneratorRuntime.awrap(_this.camera.takePictureAsync(options));\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    _this.state = {\n      hasPermission: null,\n      type: Camera.Constants.Type.front,\n      loginInfo: {}\n    };\n    return _this;\n  }\n\n  _createClass(UploadPicture, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      var _await$Camera$request, status;\n\n      return _regeneratorRuntime.async(function componentDidMount$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(Camera.requestCameraPermissionsAsync());\n\n            case 2:\n              _await$Camera$request = _context3.sent;\n              status = _await$Camera$request.status;\n              this.setState({\n                hasPermission: status === 'granted'\n              });\n              asyncStorage.getData(function (data) {\n                _this2.setState({\n                  loginInfo: data\n                });\n              });\n\n            case 6:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, this, null, Promise);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$state = this.state,\n          hasPermission = _this$state.hasPermission,\n          type = _this$state.type;\n\n      if (hasPermission) {\n        return _jsx(View, {\n          style: styles.container,\n          children: _jsx(Camera, {\n            style: styles.camera,\n            type: type,\n            ref: function ref(_ref) {\n              _this3.camera = _ref;\n              return _this3.camera;\n            },\n            children: _jsx(View, {\n              style: styles.buttonContainer,\n              children: _jsx(TouchableOpacity, {\n                style: styles.button,\n                onPress: function onPress() {\n                  _this3.takePicture();\n                },\n                children: _jsx(Text, {\n                  style: styles.text,\n                  children: \" Take Photo \"\n                })\n              })\n            })\n          })\n        });\n      }\n\n      return _jsx(Text, {\n        children: \"No access to camera\"\n      });\n    }\n  }]);\n\n  return UploadPicture;\n}(Component);\n\nUploadPicture.propTypes = {\n  navigation: PropTypes.shape({\n    navigate: PropTypes.func.isRequired,\n    addListener: PropTypes.func.isRequired\n  }).isRequired\n};\nexport default UploadPicture;\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  },\n  camera: {\n    flex: 1\n  },\n  buttonContainer: {\n    flex: 1,\n    backgroundColor: 'transparent',\n    flexDirection: 'row',\n    margin: 20\n  },\n  button: {\n    flex: 0.1,\n    alignSelf: 'flex-end',\n    alignItems: 'center'\n  },\n  text: {\n    fontSize: 18,\n    color: 'white'\n  }\n});","map":{"version":3,"sources":["D:/Users/georg/Desktop/MAD/SpaceBook/components/UploadPicture.js"],"names":["React","Component","Camera","PropTypes","DisplayAlert","Storage","asyncStorage","displayAlert","UploadPicture","props","sendToServer","data","navigation","loginInfo","state","fetch","base64","res","blob","id","method","headers","token","body","then","response","status","Promise","reject","Error","navigate","catch","error","takePicture","camera","options","quality","onPictureSaved","takePictureAsync","hasPermission","type","Constants","Type","front","requestCameraPermissionsAsync","setState","getData","styles","container","ref","buttonContainer","button","text","propTypes","shape","func","isRequired","addListener","StyleSheet","create","flex","backgroundColor","flexDirection","margin","alignSelf","alignItems","fontSize","color"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\nimport { Text, View, TouchableOpacity, StyleSheet } from 'react-native';\r\nimport { Camera } from 'expo-camera';\r\nimport PropTypes from 'prop-types';\r\nimport DisplayAlert from './DisplayAlert';\r\nimport Storage from './Storage'\r\n\r\nconst asyncStorage = new Storage();\r\n\r\nconst displayAlert = new DisplayAlert();\r\n\r\nclass UploadPicture extends Component {\r\n    constructor(props){\r\n        super(props);\r\n\r\n        this.state = {\r\n            hasPermission: null,\r\n            type: Camera.Constants.Type.front,\r\n            loginInfo: {}\r\n        }\r\n    }\r\n\r\n    async componentDidMount(){\r\n        const { status } = await Camera.requestCameraPermissionsAsync();\r\n        this.setState({hasPermission: status === 'granted'});\r\n        asyncStorage.getData((data) => {\r\n            this.setState({\r\n                loginInfo: data,\r\n            });\r\n        });\r\n    }\r\n\r\n    sendToServer = async (data) => {\r\n        const { navigation } = this.props;\r\n        const { loginInfo } = this.state;\r\n\r\n        const res = await fetch(data.base64);\r\n        const blob = await res.blob();\r\n\r\n        return fetch(`http://localhost:3333/api/1.0.0/user/${  loginInfo.id  }/photo`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'image/png',\r\n                'X-Authorization': loginInfo.token\r\n            },\r\n            body: blob\r\n        })\r\n        .then((response) => {\r\n            if (response.status === 400){\r\n                return Promise.reject(new Error(`Bad request. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 401){\r\n                return Promise.reject(new Error(`Unauthorised. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 404){\r\n                return Promise.reject(new Error(`Not found. Status: ${  response.status}`));\r\n            }\r\n            if (response.status === 500){\r\n                return Promise.reject(new Error(`Server error. Status: ${ response.status }`));\r\n            } \r\n            \r\n            displayAlert.displayAlert(`Picture uploaded`);\r\n            return navigation.navigate('Settings');\r\n        })\r\n        .catch((error) => {\r\n            displayAlert.displayAlert(error);\r\n        })\r\n    }\r\n\r\n    takePicture = async () => {\r\n        if(this.camera){\r\n            const options = {\r\n                quality: 0.5,\r\n                base64: true,\r\n                onPictureSaved: (data) => this.sendToServer(data)\r\n            };\r\n            await this.camera.takePictureAsync(options);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { hasPermission, type } = this.state;\r\n        if (hasPermission){\r\n            return (\r\n                <View style={styles.container}>\r\n                    <Camera style={styles.camera} type={type} ref={ref => {\r\n                        this.camera = ref;\r\n                        return this.camera;\r\n                    }}>\r\n                        <View style={styles.buttonContainer}>\r\n                            <TouchableOpacity style={styles.button} onPress={() => {this.takePicture()}}>\r\n                                <Text style={styles.text}> Take Photo </Text>\r\n                            </TouchableOpacity>\r\n                        </View>\r\n                    </Camera>\r\n                </View>\r\n            );\r\n        }     \r\n        return (\r\n            <Text>No access to camera</Text>\r\n        );      \r\n    }\r\n}\r\n\r\nUploadPicture.propTypes = {\r\n    navigation: PropTypes.shape({\r\n        navigate: PropTypes.func.isRequired,\r\n        addListener: PropTypes.func.isRequired\r\n    }).isRequired\r\n}\r\n\r\nexport default UploadPicture;\r\n\r\nconst styles = StyleSheet.create({\r\n    container: {\r\n      flex: 1,\r\n    },\r\n    camera: {\r\n      flex: 1,\r\n    },\r\n    buttonContainer: {\r\n      flex: 1,\r\n      backgroundColor: 'transparent',\r\n      flexDirection: 'row',\r\n      margin: 20,\r\n    },\r\n    button: {\r\n      flex: 0.1,\r\n      alignSelf: 'flex-end',\r\n      alignItems: 'center',\r\n    },\r\n    text: {\r\n      fontSize: 18,\r\n      color: 'white',\r\n    },\r\n  });"]},"metadata":{},"sourceType":"module"}